config:
  target: "{{ $processEnvironment.CLOUD_HOST }}"
  processor: "../load-test-hook.js"
  phases:
    - name: Warm up
      duration: 1
      arrivalRate: 1
    - name: Ramp up load
      duration: 10
      arrivalRate: 5
    - name: Sustained load
      duration: 20
      arrivalRate: 10
  variables:
    limit:
      - 7
before:
  flow:
    - log: "로그인"
    - patch:
        url: "/user/login"
        auth:
          user: "{{ $processEnvironment.LOAD_TEST_USERNAME }}"
          pass: "{{ $processEnvironment.LOAD_TEST_PASSWORD }}"
        json:
          isAutoLogin: false
          fcmToken: null
        afterResponse: "parseCookieValue"
        expect:
          - statusCode: 200
    - log: "(테스트) 카테고리별 활성화된 챕터 부분조회 마지막 페이징값 조회 API"
    - get:
        url: "/history/categories/active-chapter/last-page?limit={{ limit }}"
        cookie:
          loginData: "{{ cookieValue }}"
        capture:
          json: "$.result"
          as: "activeChapterLastPage"
        expect:
          - statusCode: 200
    - log: "카테고리별 검색어를 포함한 챕터수 조회 API"
    - get:
        url: "/quiz/categories/chapter"
        afterResponse: "setQuizQueryString"
        expect:
          - statusCode: 200
scenarios:
  - name: "퀴즈리뷰"
    flow:
      # 카테고리별 활성화된 챕터 부분조회 API
      - loop:
          - get:
              url: "/history/categories/active-chapter/page?limit={{ limit }}&page={{ $loopCount }}"
              cookie:
                loginData: "{{ cookieValue }}"
        count: "{{ activeChapterLastPage }}"
      # 한 챕터의 질문-선택지 전체조회 API
      - get:
          url: "/quiz/chapter?categorySeq={{ categorySeq }}&chapterNum={{ chapterNum }}"
      # 한 챕터의 선택기록 조회 API
      - get:
          url: "/history/chapter/user-option?categorySeq={{ categorySeq }}&chapterNum={{ chapterNum }}"
          cookie:
            loginData: "{{ cookieValue }}"
      # 한 챕터의 맞힌갯수 조회 API
      - get:
          url: "/history/chapter/hit-count?categorySeq={{ categorySeq }}&chapterNum={{ chapterNum }}"
          cookie:
            loginData: "{{ cookieValue }}"
      # 한 카테고리의 활성화된 챕터갯수 조회 API
      - get:
          url: "/history/category/active-chapter-count?categorySeq={{ categorySeq }}"
          cookie:
            loginData: "{{ cookieValue }}"
after:
  flow:
    - log: "로그아웃"
    - patch:
        url: "/user/logout"
        cookie:
          loginData: "{{ cookieValue }}"
