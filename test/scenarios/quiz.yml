config:
  target: "{{ $processEnvironment.CLOUD_HOST }}"
  processor: "../load-test-hook.js"
  phases:
    - name: Warm up
      duration: 1
      arrivalRate: 1
    - name: Ramp up load
      duration: 10
      arrivalRate: 5
    - name: Sustained load
      duration: 20
      arrivalRate: 10
before:
  flow:
    - log: "로그인"
    - patch:
        url: "/user/login"
        auth:
          user: "{{ $processEnvironment.LOAD_TEST_USERNAME }}"
          pass: "{{ $processEnvironment.LOAD_TEST_PASSWORD }}"
        json:
          isAutoLogin: false
          fcmToken: null
        afterResponse: "parseCookieValue"
        expect:
          - statusCode: 200
scenarios:
  - name: "퀴즈"
    flow:
      # 카테고리별 검색어를 포함한 챕터수 조회 API
      - get:
          url: "/quiz/categories/chapter"
          afterResponse: "setQuizQueryString"
          expect:
            - statusCode: 200
      # 카테고리별 활성화된 챕터 전체조회 API
      - get:
          url: "/history/categories/active-chapter"
          cookie:
            loginData: "{{ cookieValue }}"
      # 한 챕터의 질문-선택지 전체조회 API
      - get:
          url: "/quiz/chapter?categorySeq={{ categorySeq }}&chapterNum={{ chapterNum }}"
          afterResponse: "setUserOption"
          expect:
            - statusCode: 200
      # 한 챕터의 선택기록 조회 API
      - get:
          url: "/history/chapter/user-option?categorySeq={{ categorySeq }}&chapterNum={{ chapterNum }}"
          cookie:
            loginData: "{{ cookieValue }}"
          afterResponse: "getStatusCode"
      # 한 챕터의 선택기록 생성 API
      - post:
          url: "/history/chapter/user-option?categorySeq={{ categorySeq }}&chapterNum={{ chapterNum }}"
          cookie:
            loginData: "{{ cookieValue }}"
          json:
            bulk: "{{ userOption }}"
          ifTrue: "statusCode == 400"
      # 한 챕터의 선택기록 수정 API
      - put:
          url: "/history/chapter/user-option?categorySeq={{ categorySeq }}&chapterNum={{ chapterNum }}"
          cookie:
            loginData: "{{ cookieValue }}"
          json:
            bulk: "{{ userOption }}"
          ifTrue: "statusCode == 200"
      # 한 챕터의 맞힌갯수 조회 API
      - get:
          url: "/history/chapter/hit-count?categorySeq={{ categorySeq }}&chapterNum={{ chapterNum }}"
          cookie:
            loginData: "{{ cookieValue }}"
      # 한 카테고리의 활성화된 챕터갯수 조회 API
      - get:
          url: "/history/category/active-chapter-count?categorySeq={{ categorySeq }}"
          cookie:
            loginData: "{{ cookieValue }}"
after:
  flow:
    - log: "로그아웃"
    - patch:
        url: "/user/logout"
        cookie:
          loginData: "{{ cookieValue }}"
